<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login e Gerador de Senhas</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <img src="imagens/hps-fleet-logo.png" alt="Logo HPS" class="logo">

    <!-- Página de Login -->
    <div id="loginPage" class="fadeIn">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Usuário"><br>
        <input type="password" id="password" placeholder="Senha"><br>
        <button onclick="login()">Entrar</button>
        <p id="loginError" class="hidden">Usuário ou senha incorretos!</p>
    </div>

    <!-- Página de Gerador de Senhas (após login) -->
    <div id="passwordPage" class="fadeIn hidden" style="display: none;">
        <h2>Gerador de Senhas</h2>
        <button onclick="generatePassword()">Gerar Senha</button>
        <p id="generatedPassword"></p>
    </div>

    <script>
        const validUser = "admin";
        const validPass = "123456";
        let passwords = [];
        let usedPasswords = new Set(); // Conjunto para armazenar senhas já usadas

        function login() {
            let user = document.getElementById("username").value;
            let pass = document.getElementById("password").value;
            
            if (user === validUser && pass === validPass) {
                loadPasswordsFromFile();
                document.getElementById("loginPage").classList.add("hidden");
                document.getElementById("passwordPage").classList.remove("hidden");
                document.getElementById("passwordPage").style.display = "block"; // Garante exibição
            } else {
                document.getElementById("loginError").classList.remove("hidden");
            }
        }

        function generatePassword() {
            if (usedPasswords.size === passwords.length) {
                document.getElementById("generatedPassword").innerHTML = `
                    <span style="color: red; font-weight: bold;">
                        Todas as senhas foram usadas!<br>
                        Por favor, gere novas senhas no sistema.
                    </span>
                `;
                return;
            }

            let senha;
            do {
                senha = passwords[Math.floor(Math.random() * passwords.length)];
            } while (usedPasswords.has(senha)); // Evita repetir senhas já usadas

            usedPasswords.add(senha); // Marca senha como usada
            document.getElementById("generatedPassword").innerText = "Senha gerada: " + senha;
        }

        function loadPasswordsFromFile() {
            const filePath = 'https://github.com/HPS-Sistema/GeradorSenhaAPP/blob/main/senhas.json';
            fetch(filePath)
                .then(response => response.json())
                .then(data => {
                    passwords = data.senhas;
                    usedPasswords.clear(); // Reseta as senhas usadas ao carregar novas
                    alert("Senhas carregadas com sucesso!");
                })
                .catch(error => {
                    console.error('Erro ao carregar o arquivo de senhas:', error);
                    alert("Falha ao carregar o arquivo de senhas.");
                });
        }
    </script>

</body>
</html>
